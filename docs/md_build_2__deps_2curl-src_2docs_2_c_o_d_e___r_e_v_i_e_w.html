<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CrossGuard: How to do code reviews for curl</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CrossGuard
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">How to do code reviews for curl</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md104"></a> Anyone and everyone is encouraged and welcome to review code submissions in curl. This is a guide on what to check for and how to perform a successful code review.</p>
<h1><a class="anchor" id="autotoc_md105"></a>
All submissions should get reviewed</h1>
<p>All pull requests and patches submitted to the project should be reviewed by at least one experienced curl maintainer before that code is accepted and merged.</p>
<h1><a class="anchor" id="autotoc_md106"></a>
Let the tools and tests take the first rounds</h1>
<p>On initial pull requests, let the tools and tests do their job first and then start out by helping the submitter understand the test failures and tool alerts.</p>
<h1><a class="anchor" id="autotoc_md107"></a>
How to provide feedback to author</h1>
<p>Be nice. Ask questions. Provide examples or suggestions of improvements. Assume the best intentions. Remember language barriers.</p>
<p>All first-time contributors can become regulars. Let's help them go there.</p>
<h1><a class="anchor" id="autotoc_md108"></a>
Is this a change we want?</h1>
<p>If this is not a change that seems to be aligned with the project's path forward and as such cannot be accepted, inform the author about this sooner rather than later. Do it gently and explain why and possibly what could be done to make it more acceptable.</p>
<h1><a class="anchor" id="autotoc_md109"></a>
API/ABI stability or changed behavior</h1>
<p>Changing the API and the ABI may be fine in a change but it needs to be done deliberately and carefully. If not, a reviewer must help the author to realize the mistake.</p>
<p>curl and libcurl are similarly strict on not modifying existing behavior. API and ABI stability is not enough, the behavior should also remain intact as far as possible.</p>
<h1><a class="anchor" id="autotoc_md110"></a>
Code style</h1>
<p>Most code style nits are detected by checksrc but not all. Only leave remarks on style deviation once checksrc does not find anymore.</p>
<p>Minor nits from fresh submitters can also be handled by the maintainer when merging, in case it seems like the submitter is not clear on what to do. We want to make the process fun and exciting for new contributors.</p>
<h1><a class="anchor" id="autotoc_md111"></a>
Encourage consistency</h1>
<p>Make sure new code is written in a similar style as existing code. Naming, logic, conditions, etc.</p>
<h1><a class="anchor" id="autotoc_md112"></a>
Are pointers always non-NULL?</h1>
<p>If a function or code rely on pointers being non-NULL, take an extra look if that seems to be a fair assessment.</p>
<h1><a class="anchor" id="autotoc_md113"></a>
Asserts</h1>
<p>Conditions that should never be false can be verified with <code>DEBUGASSERT()</code> calls to get caught in tests and debugging easier, while not having an impact on final or release builds.</p>
<h1><a class="anchor" id="autotoc_md114"></a>
Memory allocation</h1>
<p>Can the mallocs be avoided? Do not introduce mallocs in any hot paths. If there are (new) mallocs, can they be combined into fewer calls?</p>
<p>Are all allocations handled in error paths to avoid leaks and crashes?</p>
<h1><a class="anchor" id="autotoc_md115"></a>
Thread-safety</h1>
<p>We do not like static variables as they break thread-safety and prevent functions from being reentrant.</p>
<h1><a class="anchor" id="autotoc_md116"></a>
Should features be <code>#ifdef</code>ed?</h1>
<p>Features and functionality may not be present everywhere and should therefore be <code>#ifdef</code>ed. Additionally, some features should be possible to switch on/off in the build.</p>
<p>Write <code>#ifdef</code>s to be as little of a "maze" as possible.</p>
<h1><a class="anchor" id="autotoc_md117"></a>
Does it look portable enough?</h1>
<p>curl runs "everywhere". Does the code take a reasonable stance and enough precautions to be possible to build and run on most platforms?</p>
<p>Remember that we live by C89 restrictions.</p>
<h1><a class="anchor" id="autotoc_md118"></a>
Tests and testability</h1>
<p>New features should be added in conjunction with one or more test cases. Ideally, functions should also be written so that unit tests can be done to test individual functions.</p>
<h1><a class="anchor" id="autotoc_md119"></a>
Documentation</h1>
<p>New features or changes to existing functionality <b>must</b> be accompanied by updated documentation. Submitting that in a separate follow-up pull request is not OK. A code review must also verify that the submitted documentation update matches the code submission.</p>
<p>English is not everyone's first language, be mindful of this and help the submitter improve the text if it needs a rewrite to read better.</p>
<h1><a class="anchor" id="autotoc_md120"></a>
Code should not be hard to understand</h1>
<p>Source code should be written to maximize readability and be easy to understand.</p>
<h1><a class="anchor" id="autotoc_md121"></a>
Functions should not be large</h1>
<p>A single function should never be large as that makes it hard to follow and understand all the exit points and state changes. Some existing functions in curl certainly violate this ground rule but when reviewing new code we should propose splitting into smaller functions.</p>
<h1><a class="anchor" id="autotoc_md122"></a>
Duplication is evil</h1>
<p>Anything that looks like duplicated code is a red flag. Anything that seems to introduce code that we <em>should</em> already have or provide needs a closer check.</p>
<h1><a class="anchor" id="autotoc_md123"></a>
Sensitive data</h1>
<p>When credentials are involved, take an extra look at what happens with this data. Where it comes from and where it goes.</p>
<h1><a class="anchor" id="autotoc_md124"></a>
Variable types differ</h1>
<p><code>size_t</code> is not a fixed size. <code>time_t</code> can be signed or unsigned and have different sizes. Relying on variable sizes is a red flag.</p>
<p>Also remember that endianness and &gt;= 32 bit accesses to unaligned addresses are problematic areas.</p>
<h1><a class="anchor" id="autotoc_md125"></a>
Integer overflows</h1>
<p>Be careful about integer overflows. Some variable types can be either 32 bit or 64 bit. Integer overflows must be detected and acted on <em>before</em> they happen.</p>
<h1><a class="anchor" id="autotoc_md126"></a>
Dangerous use of functions</h1>
<p>Maybe use of <code>realloc()</code> should rather use the dynbuf functions?</p>
<p>Do not allow new code that grows buffers without using dynbuf.</p>
<p>Use of C functions that rely on a terminating zero must only be used on data that really do have a null-terminating zero.</p>
<h1><a class="anchor" id="autotoc_md127"></a>
Dangerous "data styles"</h1>
<p>Make extra precautions and verify that memory buffers that need a terminating zero always have exactly that. Buffers <em>without</em> a null-terminator must not be used as input to string functions.</p>
<h1><a class="anchor" id="autotoc_md128"></a>
Commit messages</h1>
<p>Tightly coupled with a code review is making sure that the commit message is good. It is the responsibility of the person who merges the code to make sure that the commit message follows our standard (detailed in the <a class="el" href="md_build_2__deps_2curl-src_2docs_2_c_o_n_t_r_i_b_u_t_e.html">CONTRIBUTE</a> document). This includes making sure the PR identifies related issues and giving credit to reporters and helpers. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
