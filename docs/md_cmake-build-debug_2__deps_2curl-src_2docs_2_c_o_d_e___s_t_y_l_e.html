<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CrossGuard: curl C code style</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CrossGuard
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">curl C code style</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md873"></a> Source code that has a common style is easier to read than code that uses different styles in different places. It helps making the code feel like one single code base. Easy-to-read is an important property of code and helps making it easier to review when new things are added and it helps debugging code when developers are trying to figure out why things go wrong. A unified style is more important than individual contributors having their own personal tastes satisfied.</p>
<p>Our C code has a few style rules. Most of them are verified and upheld by the <code>scripts/checksrc.pl</code> script. Invoked with <code>make checksrc</code> or even by default by the build system when built after <code>./configure --enable-debug</code> has been used.</p>
<p>It is normally not a problem for anyone to follow the guidelines, as you just need to copy the style already used in the source code and there are no particularly unusual rules in our set of rules.</p>
<p>We also work hard on writing code that are warning-free on all the major platforms and in general on as many platforms as possible. Code that obviously will cause warnings will not be accepted as-is.</p>
<h1><a class="anchor" id="autotoc_md874"></a>
Naming</h1>
<p>Try using a non-confusing naming scheme for your new functions and variable names. It does not necessarily have to mean that you should use the same as in other places of the code, just that the names should be logical, understandable and be named according to what they are used for. File-local functions should be made static. We like lower case names.</p>
<p>See the <a href="https://curl.se/dev/internals.html#symbols">INTERNALS</a> document on how we name non-exported library-global symbols.</p>
<h1><a class="anchor" id="autotoc_md875"></a>
Indenting</h1>
<p>We use only spaces for indentation, never TABs. We use two spaces for each new open brace.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(something_is_true) {</div>
<div class="line">  <span class="keywordflow">while</span>(second_statement == fine) {</div>
<div class="line">    moo();</div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md876"></a>
Comments</h1>
<p>Since we write C89 code, **//** comments are not allowed. They were not introduced in the C standard until C99. We use only __/* comments */__.</p>
<div class="fragment"><div class="line"><span class="comment">/* this is a comment */</span></div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md877"></a>
Long lines</h1>
<p>Source code in curl may never be wider than 79 columns and there are two reasons for maintaining this even in the modern era of large and high resolution screens:</p>
<ol type="1">
<li>Narrower columns are easier to read than wide ones. There is a reason newspapers have used columns for decades or centuries.</li>
<li>Narrower columns allow developers to easier show multiple pieces of code next to each other in different windows. It allows two or three source code windows next to each other on the same screen - as well as multiple terminal and debugging windows.</li>
</ol>
<h1><a class="anchor" id="autotoc_md878"></a>
Braces</h1>
<p>In if/while/do/for expressions, we write the open brace on the same line as the keyword and we then set the closing brace on the same indentation level as the initial keyword. Like this:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(age &lt; 40) {</div>
<div class="line">  <span class="comment">/* clearly a youngster */</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>You may omit the braces if they would contain only a one-line statement:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(!x)</div>
<div class="line">  <span class="keywordflow">continue</span>;</div>
</div><!-- fragment --><p>For functions the opening brace should be on a separate line:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md879"></a>
'else' on the following line</h1>
<p>When adding an <b>else</b> clause to a conditional expression using braces, we add it on a new line after the closing brace. Like this:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(age &lt; 40) {</div>
<div class="line">  <span class="comment">/* clearly a youngster */</span></div>
<div class="line">}</div>
<div class="line"><span class="keywordflow">else</span> {</div>
<div class="line">  <span class="comment">/* probably grumpy */</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md880"></a>
No space before parentheses</h1>
<p>When writing expressions using if/while/do/for, there shall be no space between the keyword and the open parenthesis. Like this:</p>
<div class="fragment"><div class="line"><span class="keywordflow">while</span>(1) {</div>
<div class="line">  <span class="comment">/* loop forever */</span></div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md881"></a>
Use boolean conditions</h1>
<p>Rather than test a conditional value such as a bool against TRUE or FALSE, a pointer against NULL or != NULL and an int against zero or not zero in if/while conditions we prefer:</p>
<div class="fragment"><div class="line">result = do_something();</div>
<div class="line"><span class="keywordflow">if</span>(!result) {</div>
<div class="line">  <span class="comment">/* something went wrong */</span></div>
<div class="line">  <span class="keywordflow">return</span> result;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md882"></a>
No assignments in conditions</h1>
<p>To increase readability and reduce complexity of conditionals, we avoid assigning variables within if/while conditions. We frown upon this style:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>((ptr = malloc(100)) == NULL)</div>
<div class="line">  <span class="keywordflow">return</span> NULL;</div>
</div><!-- fragment --><p>and instead we encourage the above version to be spelled out more clearly:</p>
<div class="fragment"><div class="line">ptr = malloc(100);</div>
<div class="line"><span class="keywordflow">if</span>(!ptr)</div>
<div class="line">  <span class="keywordflow">return</span> NULL;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md883"></a>
New block on a new line</h1>
<p>We never write multiple statements on the same source line, even for short if() conditions.</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(<a class="code hl_struct" href="structa.html">a</a>)</div>
<div class="line">  <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>(b)</div>
<div class="line">  <span class="keywordflow">return</span> FALSE;</div>
<div class="ttc" id="astructa_html"><div class="ttname"><a href="structa.html">a</a></div><div class="ttdef"><b>Definition</b> unit1323.c:38</div></div>
</div><!-- fragment --><p>and NEVER:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(<a class="code hl_struct" href="structa.html">a</a>) <span class="keywordflow">return</span> TRUE;</div>
<div class="line"><span class="keywordflow">else</span> <span class="keywordflow">if</span>(b) <span class="keywordflow">return</span> FALSE;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md884"></a>
Space around operators</h1>
<p>Please use spaces on both sides of operators in C expressions. Postfix **(), [], -&gt;, ., ++, &ndash;** and Unary <b>+, -, !, ~, &amp;</b> operators excluded they should have no space.</p>
<p>Examples:</p>
<div class="fragment"><div class="line">bla = func();</div>
<div class="line">who = name[0];</div>
<div class="line">age += 1;</div>
<div class="line"><span class="keyword">true</span> = !<span class="keyword">false</span>;</div>
<div class="line">size += -2 + 3 * (<a class="code hl_struct" href="structa.html">a</a> + b);</div>
<div class="line">ptr-&gt;member = <a class="code hl_struct" href="structa.html">a</a>++;</div>
<div class="line"><span class="keyword">struct</span>.field = b--;</div>
<div class="line">ptr = &amp;address;</div>
<div class="line">contents = *pointer;</div>
<div class="line">complement = ~bits;</div>
<div class="line">empty = (!*string) ? TRUE : FALSE;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md885"></a>
No parentheses for return values</h1>
<p>We use the 'return' statement without extra parentheses around the value:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> works(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> TRUE;</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md886"></a>
Parentheses for sizeof arguments</h1>
<p>When using the sizeof operator in code, we prefer it to be written with parentheses around its argument:</p>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> size = <span class="keyword">sizeof</span>(int);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md887"></a>
Column alignment</h1>
<p>Some statements cannot be completed on a single line because the line would be too long, the statement too hard to read, or due to other style guidelines above. In such a case the statement will span multiple lines.</p>
<p>If a continuation line is part of an expression or sub-expression then you should align on the appropriate column so that it's easy to tell what part of the statement it is. Operators should not start continuation lines. In other cases follow the 2-space indent guideline. Here are some examples from libcurl:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(Curl_pipeline_wanted(<a class="code hl_struct" href="structhandle.html">handle</a>-&gt;multi, CURLPIPE_HTTP1) &amp;&amp;</div>
<div class="line">   (<a class="code hl_struct" href="structhandle.html">handle</a>-&gt;set.httpversion != CURL_HTTP_VERSION_1_0) &amp;&amp;</div>
<div class="line">   (<a class="code hl_struct" href="structhandle.html">handle</a>-&gt;set.httpreq == HTTPREQ_GET ||</div>
<div class="line">    <a class="code hl_struct" href="structhandle.html">handle</a>-&gt;set.httpreq == HTTPREQ_HEAD))</div>
<div class="line">  <span class="comment">/* did not ask for HTTP/1.0 and a GET or HEAD */</span></div>
<div class="line">  <span class="keywordflow">return</span> TRUE;</div>
<div class="ttc" id="astructhandle_html"><div class="ttname"><a href="structhandle.html">handle</a></div><div class="ttdef"><b>Definition</b> h2-pausing.c:145</div></div>
</div><!-- fragment --><p>If no parenthesis, use the default indent:</p>
<div class="fragment"><div class="line"><a class="code hl_struct" href="structdata.html">data</a>-&gt;set.http_disable_hostname_check_before_authentication =</div>
<div class="line">  (0 != va_arg(param, <span class="keywordtype">long</span>)) ? TRUE : FALSE;</div>
<div class="ttc" id="astructdata_html"><div class="ttname"><a href="structdata.html">data</a></div><div class="ttdef"><b>Definition</b> debug.c:31</div></div>
</div><!-- fragment --><p>Function invoke with an open parenthesis:</p>
<div class="fragment"><div class="line"><span class="keywordflow">if</span>(option) {</div>
<div class="line">  result = parse_login_details(option, strlen(option),</div>
<div class="line">                               (userp ? &amp;user : NULL),</div>
<div class="line">                               (passwdp ? &amp;passwd : NULL),</div>
<div class="line">                               NULL);</div>
<div class="line">}</div>
</div><!-- fragment --><p>Align with the "current open" parenthesis:</p>
<div class="fragment"><div class="line">DEBUGF(infof(<a class="code hl_struct" href="structdata.html">data</a>, <span class="stringliteral">&quot;Curl_pp_readresp_ %d bytes of trailing &quot;</span></div>
<div class="line">             <span class="stringliteral">&quot;server response left\n&quot;</span>,</div>
<div class="line">             (<span class="keywordtype">int</span>)clipamount));</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md888"></a>
Platform dependent code</h1>
<p>Use **#ifdef HAVE_FEATURE** to do conditional code. We avoid checking for particular operating systems or hardware in the #ifdef lines. The HAVE_FEATURE shall be generated by the configure script for unix-like systems and they are hard-coded in the <code>config-[system].h</code> files for the others.</p>
<p>We also encourage use of macros/functions that possibly are empty or defined to constants when libcurl is built without that feature, to make the code seamless. Like this example where the <b>magic()</b> function works differently depending on a build-time conditional:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifdef HAVE_MAGIC</span></div>
<div class="line"><span class="keywordtype">void</span> magic(<span class="keywordtype">int</span> <a class="code hl_struct" href="structa.html">a</a>)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span> <a class="code hl_struct" href="structa.html">a</a> + 2;</div>
<div class="line">}</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define magic(x) 1</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> content = magic(3);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md889"></a>
No typedefed structs</h1>
<p>Use structs by all means, but do not typedef them. Use the <code>struct name</code> way of identifying them:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>something {</div>
<div class="line">   <span class="keywordtype">void</span> *valid;</div>
<div class="line">   <span class="keywordtype">size_t</span> way_to_write;</div>
<div class="line">};</div>
<div class="line"><span class="keyword">struct </span>something instance;</div>
</div><!-- fragment --><p><b>Not okay</b>:</p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line">   <span class="keywordtype">void</span> *wrong;</div>
<div class="line">   <span class="keywordtype">size_t</span> way_to_write;</div>
<div class="line">} something;</div>
<div class="line">something instance;</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
