<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CrossGuard: Porting applications to use zlib-ng</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">CrossGuard
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Porting applications to use zlib-ng</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Zlib-ng can be used/compiled in two different modes, that require some consideration by the application developer.</p>
<h1><a class="anchor" id="autotoc_md1464"></a>
zlib-compat mode</h1>
<p>Zlib-ng can be compiled in zlib-compat mode, suitable for zlib-replacement in a single application or system-wide.</p>
<p>Please note that zlib-ng in zlib-compat mode tries to maintain both API and ABI compatibility with the original zlib. Any issues regarding compatibility can be reported as bugs.</p>
<p>In certain instances you may not be able to simply replace the zlib library/dll files and expect the application to work. The application may need to be recompiled against the zlib-ng headers and libs to ensure full compatibility.</p>
<p>It is also possible for the deflate output stream to differ from the original zlib due to algorithmic differences between the two libraries. Any tests or applications that depend on the exact length of the deflate stream being a certain value will need to be updated.</p>
<p><b>Advantages:</b></p><ul>
<li>Easy to port to, since it only requires a recompile of the application and no changes to the application code.</li>
</ul>
<p><b>Disadvantages:</b></p><ul>
<li>Can conflict with a system-installed zlib, as that can often be linked in by another library you are linking into your application. This can cause crashes or incorrect output.</li>
<li>If your application is pre-allocating a memory buffer and you are providing deflate/inflate init with your own allocator that allocates from that buffer (looking at you nginx), you should be aware that zlib-ng needs to allocate more memory than stock zlib needs. The same problem exists with Intel’s and Cloudflare’s zlib forks. Doing this is not recommended since it makes it very hard to maintain compatibility over time.</li>
</ul>
<p><b>Build Considerations:</b></p><ul>
<li>Compile against the <em>zlib.h</em> provided by zlib-ng</li>
<li>Configuration header is named <em>zconf.h</em></li>
<li>Static library is <em>libz.a</em> on Unix and macOS, or <em>zlib.lib</em> on Windows</li>
<li>Shared library is <em>libz.so</em> on Unix, <em>libz.dylib</em> on macOS, or <em>zlib1.dll</em> on Windows</li>
<li>Type <code>z_size_t</code> is <em>unsigned __int64</em> on 64-bit Windows, and <em>unsigned long</em> on 32-bit Windows, Unix and macOS</li>
<li>Type <code>z_uintmax_t</code> is <em>unsigned long</em> in zlib-compat mode, and <em>size_t</em> with zlib-ng API</li>
</ul>
<h1><a class="anchor" id="autotoc_md1465"></a>
zlib-ng native mode</h1>
<p>Zlib-ng in native mode is suitable for co-existing with the standard zlib library, allowing applications to implement support and testing separately.</p>
<p>The zlib-ng native has implemented some modernization and simplifications in its API, intended to make life easier for application developers.</p>
<p><b>Advantages:</b></p><ul>
<li>Does not conflict with other zlib implementations, and can co-exist as a system library along with zlib.</li>
<li>In certain places zlib-ng native uses more appropriate data types, removing the need for some workarounds in the API compared to zlib.</li>
</ul>
<p><b>Disadvantages:</b></p><ul>
<li>Requires minor changes to applications to use the prefixed zlib-ng function calls and structs. Usually this means a small prefix <code>zng_</code> has to be added.</li>
</ul>
<p><b>Build Considerations:</b></p><ul>
<li>Compile against <em>zlib-ng.h</em></li>
<li>Configuration header is named <em>zconf-ng.h</em></li>
<li>Static library is <em>libz-ng.a</em> on Unix and macOS, or <em>zlib-ng.lib</em> on Windows</li>
<li>Shared library is <em>libz-ng.so</em> on Unix, <em>libz-ng.dylib</em> on macOS, or <em>zlib-ng2.dll</em> on Windows</li>
<li>Type <code>z_size_t</code> is <em>size_t</em></li>
</ul>
<h1><a class="anchor" id="autotoc_md1466"></a>
zlib-ng compile-time detection</h1>
<p>To distinguish zlib-ng from other zlib implementations at compile-time check for the existence of <code>ZLIBNG_VERSION</code> defined in the zlib header. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0
</small></address>
</body>
</html>
